!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var o in e)("object"==typeof exports?exports:t)[o]=e[o]}}(this,function(){return function(t){function i(o){if(e[o])return e[o].exports;var n=e[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";i.Songbird=e(1)},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function o(t){this._sources=[],this._room=new Room(t),this._listener=new n(t)}var n=(e(!function(){var t=new Error('Cannot find module "./ambisonic-encoder.js"');throw t.code="MODULE_NOT_FOUND",t}()),e(2),e(4));e(9);o.prototype.createSource=function(t,i){},o.prototype.setRoomProperties=function(t,i){},o.prototype.setListenerPosition=function(t,i,e){},o.prototype.setListenerOrientation=function(t,i,e){},t.exports=o},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function o(t,i){void 0==i&&(i=new Object),void 0==i.minDistance&&(i.minDistance=s),void 0==i.maxDistance&&(i.maxDistance=r),void 0==i.rollofModel&&(i.rolloffModel=ROLLOFF_MODEL),this.minDistance=i.minDistance,this.maxDistance=i.maxDistance,this.setRolloffModel(i.rolloffModel),this._gainNode=t.createGain(),this.setDistance(i.maxDistance),this.input=this._gainNode,this.output=this._gainNode}var n="logarithmic",s=1,r=1e3,a=e(!function(){var t=new Error('Cannot find module "./globals.js"');throw t.code="MODULE_NOT_FOUND",t}()),h=e(3);o.prototype.setDistance=function(t){var i=1;if("logarithmic"==this._rolloffModel){if(t>this.maxDistance)i=0;else if(t>this.minDistance){var e=this.maxDistance-this.minDistance;if(e>a.EPSILON_FLOAT){var o=t-this.minDistance,n=1/(o+1),s=1/(e+1);i=(n-s)/(1-s)}}}else if("linear"==this._rolloffModel)if(t>this.maxDistance)i=0;else if(t>this.minDistance){var e=this.maxDistance-this.minDistance;e>a.EPSILON_FLOAT&&(i=(this.maxDistance-t)/e)}this._gainNode.gain.value=i},o.prototype.setRolloffModel=function(t){t=t.toString().toLowerCase();var i=~a.ROLLOFF_MODELS.indexOf(t);void 0!=t&&i||(i||h.log('Invalid rolloff model ("'+t+'"). Using default: "'+n+'".'),t=n),this._rolloffModel=t},t.exports=o},function(t,i){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";i.log=function(){window.console.log.apply(window.console,["%c[Songbird]%c "+Array.prototype.slice.call(arguments).join(" ")+" %c(@"+performance.now().toFixed(2)+"ms)","background: #BBDEFB; color: #FF5722; font-weight: 700","font-weight: 400","color: #AAA"])},i.toQuaternion=function(t,i,e){var o=Math.cos(.5*e),n=Math.sin(.5*e),s=Math.cos(.5*t),r=Math.sin(.5*t),a=Math.cos(.5*i),h=Math.sin(.5*i);return[o*s*a+n*r*h,o*r*a-n*s*h,o*s*h+n*r*a,n*s*a-o*r*h]},i.hamiltonProduct=function(t,i){return[t[0]*i[0]-t[1]*i[1]-t[2]*i[2]-t[3]*i[3],t[0]*i[1]+t[1]*i[0]+t[2]*i[3]-t[3]*i[2],t[0]*i[2]-t[1]*i[3]+t[2]*i[0]+t[3]*i[1],t[0]*i[3]+t[1]*i[2]-t[2]*i[1]+t[3]*i[0]]},i.rotateVector=function(t,e){var o=i.hamiltonProduct(i.hamiltonProduct(e,[0,t[0],t[1],t[2]]),[e[0],-e[1],-e[2],-e[3]]);return[o[1],o[2],o[3]]}},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function o(t,i){void 0==i&&(i=new Object),void 0==i.ambisonicOrder&&(i.ambisonicOrder=a.DEFAULT_AMBISONIC_ORDER),void 0==i.speedOfSound&&(i.speedOfSound=a.SPEED_OF_SOUND),void 0==i.position&&(i.position=a.DEFAULT_POSITION),void 0==i.orientation&&(i.orientation=a.DEFAULT_ORIENTATION),this.speedOfSound=i.speedOfSound,this._context=t,this._ambisonicOrder=i.ambisonicOrder,this._position=new Float32Array(3),this._forward=new Float32Array(3),this._up=new Float32Array(3),this._right=new Float32Array(3),this._reflections=new n(t,i),this._reverb=new s(t),this._roomGain=t.createGain(),this.output=t.createGain(),this._reverb.output.connect(this._roomGain),this._roomGain.connect(this.output),this.setPosition(i.position[0],i.position[1],i.position[2]),this.setOrientation(i.orientation[0],i.orientation[1],i.orientation[2]),this.setRoomProperties(i.dimensions,i.materials)}var n=e(!function(){var t=new Error('Cannot find module "./reflections.js"');throw t.code="MODULE_NOT_FOUND",t}()),s=e(!function(){var t=new Error('Cannot find module "./reverb.js"');throw t.code="MODULE_NOT_FOUND",t}()),r=e(5),a=e(!function(){var t=new Error('Cannot find module "./globals.js"');throw t.code="MODULE_NOT_FOUND",t}()),h=e(3);o.prototype.setPosition=function(t,i,e){this._position=[t,i,e],this._reflections.speedOfSound=this.speedOfSound,this._reflections.setListenerPosition(t,i,e),Math.abs(this._position[0])>this._reflections._halfDimensions.width||Math.abs(this._position[1])>this._reflections._halfDimensions.height||Math.abs(this._position[2])>this._reflections._halfDimensions.depth?this._roomGain.gain.value=0:this._roomGain.gain.value=1},o.prototype.setOrientation=function(t,i,e){var o=h.toQuaternion(t,i,e);this._forward=h.rotateVector(a.DEFAULT_FORWARD,o),this._up=h.rotateVector(a.DEFAULT_UP,o),this._right=h.rotateVector(a.DEFAULT_RIGHT,o)},o.prototype.setRoomProperties=function(t,i){var e=r.getCoefficientsFromMaterials(i),o=r.computeRT60Secs(t,e,this.speedOfSound);this._reverb.setRT60s(o),this._reflections.speedOfSound=this.speedOfSound,this._reflections.setRoomProperties(t,e)},t.exports=o},function(t,i,e){/**
	 * @license
	 * Copyright 2017 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function o(t,i){void 0==i&&(i={}),void 0==i.speedOfSound&&(i.speedOfSound=f.SPEED_OF_SOUND),this.speedOfSound=i.speedOfSound,i.dimensions=s(i.dimensions),coefficients=n(i.materials),durations=r(dimensions,coefficients,i.speedOfSound),this.earlyReflections=new v(t,{dimensions:i.dimensions,coefficients:coefficients,speedOfSound:i.speedOfSound,listenerPosition:i.listenerPosition}),this.lateReflections=new p(t,{durations:durations}),this.output=t.createGain(),this.earlyReflections.output.connect(this.output),this.lateReflections.output.connect(this.output)}function n(t){var i={};for(var e in l)i[e]=d[l[e]];void 0==t&&(t=l);for(var e in l)t.hasOwnProperty(e)?t[e]in d?i[e]=d[t[e]]:u.log('Material "'+t[e]+'" on wall "'+e+'" not found. Using "'+l[e]+'".'):u.log('Wall "'+e+'" is not defined. Default used.');return i}function s(t){void 0==t&&(t={});for(var i in _)dimensons.hasOwnProperty(i)||(t[i]=_[i]);return t}function r(t,i,e){var n=new Float32Array(Globals.NUMBER_REVERB_BANDS);t=o.sanitizeDimensions(t),i=o.sanitizeCoefficients(i),void 0==e&&(e=Globals.SPEED_OF_SOUND);var s=Globals.TWENTY_FOUR_LOG10/e,r=t.width*t.height*t.depth;if(r<a)return n;for(var _=t.width*t.height,l=t.width*t.depth,d=t.depth*t.height,f=2*(_+l+d),u=0;u<Globals.NUMBER_REVERB_BANDS;u++){var p=(i.left[u]+i.right[u])*_+(i.down[u]+i.up[u])*l+(i.front[u]+i.back[u])*d,v=p/f;v<=.5?n[u]=s*r/(p+4*h[u]*r):n[u]=c*s*r/(-f*Math.log(1-v)+4*h[u]*r)}return n}var a=1e-4,h=[6e-4,6e-4,7e-4,8e-4,.001,.0015,.0026,.006,.0207],c=1.38,_={width:0,height:0,depth:0},l={left:"transparent",right:"transparent",front:"transparent",back:"transparent",down:"transparent",up:"transparent"},d={transparent:[1,1,1,1,1,1,1,1,1],"acoustic-ceiling-tiles":[.672,.675,.7,.66,.72,.92,.88,.75,1],"brick-bare":[.03,.03,.03,.03,.03,.04,.05,.07,.14],"brick-painted":[.006,.007,.01,.01,.02,.02,.02,.03,.06],"concrete-block-coarse":[.36,.36,.36,.44,.31,.29,.39,.25,.5],"concrete-block-painted":[.092,.09,.1,.05,.06,.07,.09,.08,.16],"curtain-heavy":[.073,.106,.14,.35,.55,.72,.7,.65,1],"fiber-glass-insulation":[.193,.22,.22,.82,.99,.99,.99,.99,1],"glass-thin":[.18,.169,.18,.06,.04,.03,.02,.02,.04],"glass-thick":[.35,.35,.35,.25,.18,.12,.07,.04,.08],grass:[.05,.05,.15,.25,.4,.55,.6,.6,.6],"linoleum-on-concrete":[.02,.02,.02,.03,.03,.03,.03,.02,.04],marble:[.01,.01,.01,.01,.01,.01,.02,.02,.04],metal:[.03,.035,.04,.04,.05,.05,.05,.07,.09],"parquet-on-concrete":[.028,.03,.04,.04,.07,.06,.06,.07,.14],"plaster-rough":[.017,.018,.02,.03,.04,.05,.04,.03,.06],"plaster-smooth":[.011,.012,.013,.015,.02,.03,.04,.05,.1],"plywood-panel":[.4,.34,.28,.22,.17,.09,.1,.11,.22],"polished-concrete-or-tile":[.008,.008,.01,.01,.015,.02,.02,.02,.04],"sheet-rock":[.29,.279,.29,.1,.05,.04,.07,.09,.18],"water-or-ice-surface":[.006,.006,.008,.008,.013,.015,.02,.025,.05],"wood-ceiling":[.15,.147,.15,.11,.1,.07,.06,.07,.14],"wood-panel":[.28,.28,.28,.22,.17,.09,.1,.11,.22],uniform:[.5,.5,.5,.5,.5,.5,.5,.5,.5]},f=e(6),u=e(3),p=e(7),v=e(8);o.prototype.setProperties=function(t,i){coefficients=n(i),durations=r(t,coefficients,this.speedOfSound),this.earlyReflections.speedOfSound=this.speedOfSound,this.earlyReflections.setRoomProperties(t,coefficients),this.lateReflections.setDurations(durations)},o.prototype.setListenerPosition=function(t,i,e){this.earlyReflections.speedOfSound=this.speedOfSound,this.earlyReflections.setListenerPosition(t,i,e)},t.exports=o},function(t,i){/**
	 * @license
	 * Copyright 2017 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";i.TWO_PI=6.28318530717959,i.TWENTY_FOUR_LOG10=55.2620422318571,i.LOG1000=6.90775527898214,i.LOG2_DIV2=.346573590279973,i.DEGREES_TO_RADIANS=.017453292519943,i.RADIANS_TO_DEGREES=57.29577951308232,i.EPSILON_FLOAT=1e-6,i.DEFAULT_GAIN_LINEAR=1,i.DEFAULT_POSITION=[0,0,0],i.DEFAULT_ORIENTATION=[0,0,0],i.DEFAULT_FORWARD=[0,0,1],i.DEFAULT_UP=[0,1,0],i.DEFAULT_RIGHT=[1,0,0],i.DEFAULT_AMBISONIC_ORDER=1,i.SPEED_OF_SOUND=343,i.REVERB_BANDS=[31.25,62.5,125,250,500,1e3,2e3,4e3,8e3],i.NUMBER_REVERB_BANDS=i.REVERB_BANDS.length},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function o(t,i){this._context=t,void 0==i&&(i={}),void 0==i.durations&&(i.durations=new Float32Array(_.NUMBER_REVERB_BANDS)),void 0==i.predelayMs&&(i.predelayMs=r),void 0==i.gain&&(i.gain=h),this._enabled=!1;var e=i.predelayMs/1e3;this.input=t.createGain(),this._predelay=t.createDelay(e),this._convolver=t.createConvolver(),this.output=t.createGain(),this.output.gain.value=i.gain,this._convolver.normalize=!1,this.input.connect(this._predelay),this._predelay.connect(this._convolver),this._convolver.connect(this.output),this.setRT60s(i.durations)}var n=1,s=1,r=1.5,a=3.8,h=.01,c=3,_=e(!function(){var t=new Error('Cannot find module "./globals.js"');throw t.code="MODULE_NOT_FOUND",t}()),l=e(3);o.prototype.setDurations=function(t){if(t.length!==_.NUMBER_REVERB_BANDS)return void l.log("Warning: invalid number of RT60 values provided to reverb.");for(var i=new Float32Array(_.NUMBER_REVERB_BANDS),e=this._context.sampleRate,o=0;o<t.length;o++)t[o]=Math.max(0,Math.min(c,t[o])),i[o]=Math.round(t[o]*e*s);for(var r=0,o=0;o<i.length;o++)i[o]>r&&(r=i[o]);r<1&&(r=1);for(var h=this._context.createBuffer(1,r,e),d=h.getChannelData(0),f=new Float32Array(r),o=0;o<r;o++)f[o]=2*Math.random()-1;for(var o=0;o<_.NUMBER_REVERB_BANDS;o++)for(var u=-_.LOG1000/i[o],p=_.TWO_PI*_.REVERB_BANDS[o]/e,v=Math.sin(p),D=v*Math.sinh(_.LOG2_DIV2*n*p/v),O=1/(1+D),m=D*O,E=-2*Math.cos(p)*O,g=(1-D)*O,R=0,w=0,y=0;y<i[o];y++){var A=f[y]*Math.exp(u*y),S=A-E*R-g*w;d[y]+=m*(S-w),w=R,R=S}for(var M=Math.round(a/1e3*e),o=0;o<Math.min(d.length,M);o++){var N=.5*(1-Math.cos(_.TWO_PI*o/(2*M-1)));d[o]*=N}this._convolver.buffer=h},t.exports=o},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function o(t,i){void 0==i&&(i={}),void 0==i.speedOfSound&&(i.speedOfSound=l.SPEED_OF_SOUND),void 0==i.listenerPosition&&(i.listenerPosition=l.DEFAULT_POSITION),this.speedOfSound=i.speedOfSound,this.input=t.createGain(),this.output=t.createGain(),this._lowpass=t.createBiquadFilter(),this._delays={},this._gains={},this._inverters={},this._merger=t.createChannelMerger(4);for(var e in c)this._delays[e]=t.createDelay(s),this._gains[e]=t.createGain();this._inverters.right=t.createGain(),this._inverters.down=t.createGain(),this._inverters.back=t.createGain(),this._lowpass.type="lowpass",this._lowpass.frequency.value=r,this._lowpass.Q.value=0;for(var e in c)this._delays[e].delayTime.value=0,this._gains[e].gain.value=0;this._inverters.right.gain.value=-1,this._inverters.down.gain.value=-1,this._inverters.back.gain.value=-1,this.input.connect(this._lowpass);for(var e in c)this._lowpass.connect(this._delays[e]),this._delays[e].connect(this._gains[e]),this._gains[e].connect(this._merger,0,0);this._gains.left.connect(this._merger,0,1),this._gains.right.connect(this._inverters.right),this._inverters.right.connect(this._merger,0,1),this._gains.up.connect(this._merger,0,2),this._gains.down.connect(this._inverters.down),this._inverters.down.connect(this._merger,0,2),this._gains.front.connect(this._merger,0,3),this._gains.back.connect(this._inverters.back),this._inverters.back.connect(this._merger,0,3),this._merger.connect(this.output),this._listenerPosition=i.listenerPosition,this.setRoomProperties(i.dimensions,i.coefficients)}function n(t){var i=c;for(var e in c){for(var o=0;o<h;o++){var n=o+a;i[e]+=t[e][n]}i[e]/=h,i[e]=Math.sqrt(1-i[e])}return i}var s=.5,r=6400,a=4,h=3,c={left:0,right:0,front:0,back:0,down:0,up:0},_=1,l=e(!function(){var t=new Error('Cannot find module "./globals.js"');throw t.code="MODULE_NOT_FOUND",t}());o.prototype.setListenerPosition=function(t,i,e){this._listenerPosition=[t,i,e];var o={left:this._halfDimensions.width+t+_,right:this._halfDimensions.width-t+_,front:this._halfDimensions.depth+e+_,back:this._halfDimensions.depth-e+_,down:this._halfDimensions.height+i+_,up:this._halfDimensions.height-i+_};for(var n in c){var s=o[n]/this.speedOfSound;this._delays[n].delayTime.value=s;var r=this._reflectionCoefficients[n]/o[n];this._gains[n].gain.value=r}},o.prototype.setRoomProperties=function(t,i){this._reflectionCoefficients=n(i),this._halfDimensions={},this._halfDimensions.width=.5*t.width,this._halfDimensions.height=.5*t.height,this._halfDimensions.depth=.5*t.depth,this.setListenerPosition(this._listenerPosition[0],this._listenerPosition[1],this._listenerPosition[2])},t.exports=o},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function o(t,i){void 0==i&&(i=new Object),void 0==i.gain&&(i.gain=r.DEFAULT_GAIN_LINEAR),void 0==i.position&&(i.position=r.DEFAULT_POSITION),void 0==i.orientation&&(i.orientation=r.DEFAULT_ORIENTATION),this._listener=t,this._position=new Float32Array(3),this._forward=new Float32Array(3),this._up=new Float32Array(3),this._right=new Float32Array(3),this._directivity_alpha=0,this._directivity_order=1;var e=t._context;this.input=e.createGain(),this._directivity=e.createBiquadFilter(),this._toReflections=e.createGain(),this._toReverb=e.createGain(),this._attenuation=new n(e,i),this._encoder=new s(e,t._ambisonicOrder),this._directivity.type="lowpass",this._directivity.Q.value=0,this._directivity.frequency.value=.5*t._context.sampleRate,this.input.connect(this._attenuation.input),this.input.connect(this._toReverb),this._toReverb.connect(t._reverb.input),this._attenuation.output.connect(this._toReflections),this._toReflections.connect(t._reflections.input),this._attenuation.output.connect(this._directivity),this._directivity.connect(this._encoder.input),this._encoder.output.connect(t.output),this.setPosition(i.position[0],i.position[1],i.position[2]),this.setOrientation(i.orientation[0],i.orientation[1],i.orientation[2]),this.input.gain.value=i.gain}var n=e(2),s=e(!function(){var t=new Error('Cannot find module "./ambisonic-encoder.js"');throw t.code="MODULE_NOT_FOUND",t}()),r=e(!function(){var t=new Error('Cannot find module "./globals.js"');throw t.code="MODULE_NOT_FOUND",t}()),a=e(3);o.prototype.setPosition=function(t,i,e){var o=new Float32Array(3);this._position[0]=t,this._position[1]=i,this._position[2]=e,this._computeDistanceOutsideRoom();for(var n=0;n<3;n++)o[n]=this._position[n]-this._listener._position[n];var s=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);o[0]/=s,o[1]/=s,o[2]/=s,this._computeDirectivity(o);var a=Math.atan2(-o[0],o[2])*r.RADIANS_TO_DEGREES,h=Math.atan2(o[1],Math.sqrt(o[0]*o[0]+o[2]*o[2]))*r.RADIANS_TO_DEGREES;this._attenuation.setDistance(s),this._encoder.setDirection(a,h)},o.prototype.setAngleFromListener=function(t,i,e){void 0==i&&(i=0),void 0==e&&(e=1);var o=t*r.DEGREES_TO_RADIANS,n=i*r.DEGREES_TO_RADIANS,s=Math.sin(o)*Math.cos(n),a=Math.sin(n),h=-Math.cos(o)*Math.cos(n);this._computeDirectivity([s,a,h]),this._position[0]=this._listener._position[0]+s,this._position[1]=this._listener._position[1]+a,this._position[2]=this._listener._position[2]+h,this._computeDistanceOutsideRoom(),this._attenuation.setDistance(e),this._encoder.setDirection(t,i)},o.prototype.setOrientation=function(t,i,e){var o=a.toQuaternion(t,i,e);this._forward=a.rotateVector(r.DEFAULT_FORWARD,o),this._up=a.rotateVector(r.DEFAULT_UP,o),this._right=a.rotateVector(r.DEFAULT_RIGHT,o)},o.prototype.setSpread=function(t){},o.prototype.setDirectivity=function(t,i){this._directivity_alpha=Math.min(1,Math.max(0,t)),void 0!==i&&(this._directivity_order=Math.min(1,i))},o.prototype._computeDirectivity=function(t){var i=1;if(this._directivity_alpha>r.EPSILON_FLOAT){var e=this._forward[0]*t[0]+this._forward[1]*t[1]+this._forward[2]*t[2];i=1-this._directivity_alpha+this._directivity_alpha*e,i=Math.pow(Math.abs(i),this._directivity_order)}this._directivity.frequency.value=.5*this._listener._context.sampleRate*i},o.prototype._computeDistanceOutsideRoom=function(){var t=Math.max(0,-this._listener._reflections._halfDimensions.width-this._position[0],this._position[0]-this._listener._reflections._halfDimensions.width),i=Math.max(0,-this._listener._reflections._halfDimensions.height-this._position[1],this._position[1]-this._listener._reflections._halfDimensions.height),e=Math.max(0,-this._listener._reflections._halfDimensions.depth-this._position[2],this._position[2]-this._listener._reflections._halfDimensions.depth),o=Math.sqrt(t*t+i*i+e*e),n=1;o>r.EPSILON_FLOAT&&(n=Math.max(1,1-o)),this._toReverb.gain.value=n,this._toReflections.gain.value=n},t.exports=o}])});